$(document).ready(function(e){function o(o,r,n,i,c){o.length>1&&o!=u.oldQuery&&(window.history.pushState(o,e("title").html(),"?q="+o),document.title=o.split(" -")[0]+" - "+u.title),u.oldQuery=o;var p={q:o,sort:u.sort,auto_complete:d.autoComplete,access_token:d.accessToken,count:d.count};null!=r&&null!=n&&(p.captcha_sid=r,p.captcha_key=n),p.performer_only=c?1:1==u.performerOnly?1:0,e.ajax({url:u.proxyMode?u.appUrl+"search.php":d.url,data:p,method:"GET",dataType:"jsonp",cache:!0,beforeSend:function(){e("#loading").show()},error:function(){a(i18n.t("networError"))},success:function(o){if(o.error)return a(5==o.error.error_code?i18n.t("tokenError"):i18n.t("error",{error:o.error.error_msg})),void(14==o.error.error_code&&l(o.error.captcha_sid,o.error.captcha_img));if(0==o.response)return void a(i18n.t("notFound"));e("#result > .list-group").html("");for(var r=1;r<o.response.length;r++)downloadUrl=u.downloadServerUrl,streamUrl=u.downloadServerUrl,ownerId=o.response[r].owner_id,aid=o.response[r].aid,u.prettyDownloadUrlMode?(streamUrl+="stream/",ownerId<0&&(ownerId*=-1,downloadUrl+="-",streamUrl+="-"),prettyId=s(ownerId)+":"+s(aid),downloadUrl+=prettyId,streamUrl+=prettyId):(downloadUrl+="download.php?audio_id="+ownerId+"_"+aid,streamUrl+="download.php?stream=true&audio_id="+ownerId+"_"+aid),audioTitle=o.response[r].artist+" - "+o.response[r].title,audioDuration=o.response[r].duration.toTime(),e("#result > .list-group").append('<li class="list-group-item"><span class="badge">'+audioDuration+'</span><span class="badge play" data-i18n="[title]clickToPlay"><span class="glyphicon glyphicon-play"></span></span><a class="iframe-download" data-i18n="[title]clickToDownload" target="_blank" data-src="'+(u.proxyMode?streamUrl:o.response[r].url)+'" href="'+downloadUrl+'">'+audioTitle+"</a></li>");if(e(".list-group").i18n(),e(".iframe-download").on("click",function(o){o.preventDefault(),url=e(this).attr("href"),e("<iframe/>").attr({src:url,style:"visibility:hidden;display:none"}).appendTo(e("body"))}),i)try{ga("send","event","search",_query)}catch(n){}e(".play").on("click",function(e){t(this)}),e("#loading").hide()}})}function r(){itemCount=e(".list-group-item").length-1,u.currentTrack>=0&&itemCount>=u.currentTrack?t(e(e(".list-group-item")[u.currentTrack+1]).find(".play")):(console.log("seems like there no audios to play, i think. playing first one."),t(e(e(".list-group-item")[0]).find(".play")))}function n(){u.currentTrack-1>=0?t(e(e(".list-group-item")[u.currentTrack-1]).find(".play")):(console.log("this is first audio, nothing in back. playing last one."),itemCount=e(".list-group-item").length-1,t(e(e(".list-group-item")[itemCount]).find(".play")))}function t(o){e("#jquery_jplayer_1").jPlayer("setMedia",{mp3:e(o).parent().find("a").attr("data-src")}),e("#jquery_jplayer_1").jPlayer("play"),e("#jp_container_1").show(),u.currentTrack=e(".list-group-item").index(e(o).parent()),e(".list-group").find(".glyphicon-pause").each(function(o,r){e(r).removeClass("glyphicon-pause"),e(r).addClass("glyphicon-play")}),e(o).find(".glyphicon").removeClass("glyphicon-play"),e(o).find(".glyphicon").addClass("glyphicon-pause")}function a(o){e("#result > .list-group").html(""),e("#result > .list-group").append('<li class="list-group-item list-group-item-danger">'+o+"</li>"),e("#loading").hide()}function i(){return paramQuery=c("q"),paramQuery.length>1?(o(paramQuery,null,null,!0),e("#query").val(paramQuery),!0):!1}function l(r,n){try{ga("send","event","captcha")}catch(t){}e("#captchaModal").modal("show"),e("#captchaImage").attr("src",n),e("#captchaImage").on("click",function(o){e(this).attr("src",n)}),e("#captchaSend").on("click",function(){e("#captchaModal").modal("hide"),o(e("#query").val(),r,e("#captchaKey").val(),!0)}),e("#captchaKey").bind("keypress",function(o){13==o.keyCode&&e("#captchaSend").trigger("click")})}function c(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=o.exec(location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function s(e){length=k.length;var o="";if(0==e)return k[0];for(;e>0;)val=parseInt(e%length),e=parseInt(e/length),o+=k[val];return o}e(document).keydown(function(e){var o=e.charCode?e.charCode:e.keyCode;39==o?r():37==o&&n()});var d={url:"https://api.vk.com/method/audio.search",autoComplete:1,accessToken:"fff9ef502df4bb10d9bf50dcd62170a24c69e98e4d847d9798d63dacf474b674f9a512b2b3f7e8ebf1d69",count:300},u={title:"datmusic",appUrl:"http://datmusic.xyz/",downloadServerUrl:"http://datmusic.xyz/",proxyMode:!0,prettyDownloadUrlMode:!0,performerOnly:!1,sort:2,oldQuery:null,defaultLang:"en",langCookie:"musicLang",sortCookie:"musicSort",performerOnlyCookie:"musicPerformerOnly",currentTrack:-1};i18n.init({lng:e.cookie(u.langCookie)?e.cookie(u.langCookie):u.defaultLang,resStore:locales,cookieName:u.langCookie},function(o,r){e("body").i18n()}),e('[data-toggle="tooltip"]').tooltip();var p=navigator.userAgent.toLowerCase(),y=p.indexOf("android")>-1;if(y){var h=confirm(i18n.t("apkDownload"));if(1==h){var m=window.open("http://bitly.com/M-APK","_blank");m.focus()}}if(e("#settings").on("click",function(o){e("#settingsModal").modal("show")}),e("#languageSelect").val(i18n.lng()),e.cookie(u.sortCookie)?(e("#sortSelect").val(e.cookie(u.sortCookie)),u.sort=e.cookie(u.sortCookie)):e("#sortSelect").val(u.sort),"true"==e.cookie(u.performerOnlyCookie)&&(e("#performerOnlyCheck").prop("checked",e.cookie(u.performerOnlyCookie)),u.performerOnly=e.cookie(u.performerOnlyCookie)),e("#languageSelect").on("change",function(o){i18n.setLng(e(this).val(),function(o,r){e("body").i18n(),title=e("#jp_container_1").attr("title"),e("#jp_container_1").attr("data-original-title",title),e("#jp_container_1").attr("title","")})}),e("#sortSelect").on("change",function(r){sortType=parseInt(e(this).val()),u.sort=sortType,e.cookie(u.sortCookie,sortType),null!=u.oldQuery&&o(u.oldQuery,null,null,!0)}),e("#performerOnlyCheck").change(function(){isChecked=e(this).is(":checked"),u.performerOnly=isChecked,e.cookie(u.performerOnlyCookie,isChecked),null!=u.oldQuery&&o(u.oldQuery,null,null,!0)}),e("#query").bind("keypress",function(o){13==o.keyCode&&e(".search").trigger("click")}),e(".search").on("click",function(r){typedQuery=e("#query").val(),""!=typedQuery&&o(typedQuery,null,null,!0)}),e("#jquery_jplayer_1").jPlayer({swfPath:u.appUrl+"js",supplied:"mp3",wmode:"window",smoothPlayBar:!0,keyEnabled:!0,remainingDuration:!0,toggleDuration:!0,volume:1,keyBindings:{play:{key:32,fn:function(e){e.status.paused?e.play():e.pause()}}},ended:function(){itemCount=e(".list-group-item").length,console.log("#"+u.currentTrack+" ended, audio count in dom = "+itemCount),r()}}),window.onpopstate=function(e){i(),console.log(e)},!i()){var f=["Kygo","Ed Sheeran","Toe","Coldplay","The xx","MS MR","Macklemore","Lorde","Birdy","Seinabo Sey","Sia","M83","Hans Zimmer","Keaton Henson","Yiruma","Martin Garrix","Calvin Harris","Zinovia","Avicii","Of Monsters and Men","Josef Salvat","Sam Smith","deadmau5","Yann Tiersen","Jessie J"," Maroon 5","X ambassadors","Fink","Young Summer","Lana Del Rey","Arctic Monkeys","Ludovico Einaudi","Lera Lynn","Bastille","Nils Frahm","Ben Howard","Andrew Belle","Mumford & Sons","Ryan Keen","Zes","Greg Haines","Max Richter"],g=f[Math.floor(Math.random()*f.length)];o(g,null,null,!1,!0),e("#query").val(g)}var k=["A","B","C","D","E","F","G","H","J","K","M","N","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","j","k","m","n","p","q","r","s","t","u","v","x","y","z","1","2","3"];Number.prototype.toTime=function(){var e=parseInt(this,10),o=Math.floor(e/3600),r=Math.floor((e-3600*o)/60),n=e-3600*o-60*r;10>r&&(r="0"+r),10>n&&(n="0"+n);var t=r+":"+n;return t}});