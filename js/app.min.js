$(document).ready(function(e){function o(o,r,n,l,c){p.currentTrack=-1,o.length>1&&o!=p.oldQuery&&(window.history.pushState(o,e("title").html(),"?q="+o),document.title=o.split(" -")[0]+" - "+p.title),p.oldQuery=o;var h={q:o,sort:p.sort,auto_complete:u.autoComplete,access_token:u.accessToken,count:u.count};null!=r&&null!=n&&(h.captcha_sid=r,h.captcha_key=n),h.performer_only=c?1:1==p.performerOnly?1:0,url=p.proxyMode?p.appUrl+"search.php":u.url,e.ajax({url:url,data:h,method:"GET",dataType:"jsonp",cache:!0,beforeSend:function(){e("#loading").show()},error:function(){t(i18n.t("networkError"))},success:function(r){if(r.error)return t(5==r.error.error_code?i18n.t("tokenError"):i18n.t("error",{error:r.error.error_msg})),void(14==r.error.error_code&&i(r.error.captcha_sid,r.error.captcha_img));if(0==r.response)return void t(i18n.t("notFound"));e("#result > .list-group").html("");for(var n=1;n<r.response.length;n++)downloadUrl=p.downloadServerUrl,streamUrl=p.downloadServerUrl,ownerId=r.response[n].owner_id,aid=r.response[n].aid,p.prettyDownloadUrlMode?(streamUrl+="stream/",ownerId<0&&(ownerId*=-1,downloadUrl+="-",streamUrl+="-"),prettyId=s(ownerId)+":"+s(aid),downloadUrl+=prettyId,streamUrl+=prettyId):(downloadUrl+="download.php?audio_id="+ownerId+"_"+aid,streamUrl+="download.php?stream=true&audio_id="+ownerId+"_"+aid),audioTitle=r.response[n].artist+" - "+r.response[n].title,audioDuration=r.response[n].duration.toTime(),audioView={clickToPlay:i18n.t("clickToPlay"),clickToDownload:i18n.t("clickToDownload"),duration:r.response[n].duration.toTime(),url:{stream:p.proxyMode?streamUrl:r.response[n].url,download:{original:downloadUrl,64:downloadUrl+(p.prettyDownloadUrlMode?"/64":"&bitrate=64"),128:downloadUrl+(p.prettyDownloadUrlMode?"/128":"&bitrate=128"),192:downloadUrl+(p.prettyDownloadUrlMode?"/192":"&bitrate=192"),320:downloadUrl+(p.prettyDownloadUrlMode?"/320":"&bitrate=320")}},audio:r.response[n].artist+" - "+r.response[n].title},audioRendered=Mustache.render(y,audioView),e("#result > .list-group").append(audioRendered);d("search",o),e(".play").on("click",function(o){a(e(".list-group-item").index(e(this).parent()))}),e("#loading").hide()}})}function r(){0>p.currentTrack||(itemCount=e(".list-group-item").length-1,p.currentTrack+1<=itemCount?a(p.currentTrack+1):(console.log("seems like there no audios to play, i think. playing first one."),a(0)),d("play","next"))}function n(){0>p.currentTrack||(p.currentTrack-1>=0?a(p.currentTrack-1):(console.log("this is first audio, nothing in back. playing last one."),itemCount=e(".list-group-item").length-1,a(itemCount)),d("play","prev"))}function a(o){return el=e(e(".list-group-item")[o]).find(".play"),o==p.currentTrack?void(e("#jquery_jplayer_1").data().jPlayer.status.paused?(e("#jquery_jplayer_1").jPlayer("play"),e(el).find(".glyphicon").removeClass("glyphicon-play"),e(el).find(".glyphicon").addClass("glyphicon-pause")):(e("#jquery_jplayer_1").jPlayer("pause"),e(el).find(".glyphicon").removeClass("glyphicon-pause"),e(el).find(".glyphicon").addClass("glyphicon-play"))):el.length?(e("#jquery_jplayer_1").jPlayer("setMedia",{mp3:e(el).parent().find("a").attr("data-src")}),e("#jquery_jplayer_1").jPlayer("play"),e("#jp_container_1").show(),e("#player-space").show(),p.currentTrack=o,e(".list-group").find(".glyphicon-pause").each(function(o,r){e(r).removeClass("glyphicon-pause"),e(r).addClass("glyphicon-play")}),e(el).find(".glyphicon").removeClass("glyphicon-play"),e(el).find(".glyphicon").addClass("glyphicon-pause"),void d("playAudio",e(e(".list-group-item")[o]).find("a").html())):void console.log("#"+o+" audio not found in dom")}function t(o){e("#result > .list-group").html(""),e("#result > .list-group").append('<li class="list-group-item list-group-item-danger">'+o+"</li>"),e("#loading").hide()}function l(){return paramQuery=c("q"),paramQuery.length>1?(o(paramQuery,null,null,!0),e("#query").val(paramQuery),!0):!1}function i(r,n){p.captchaProxy&&(n=p.captchaProxyUrl+n),e("#captchaModal").modal("show"),e("#captchaImage").attr("src",n),e("#captchaImage").on("click",function(o){e(this).attr("src",n)}),e("#captchaSend").on("click",function(){e("#captchaModal").modal("hide"),o(e("#query").val(),r,e("#captchaKey").val(),!0)}),e("#captchaKey").bind("keypress",function(o){13==o.keyCode&&e("#captchaSend").trigger("click")}),d("captcha")}function c(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=o.exec(location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function d(e,o){try{ga&&ga("send","event",e,o)}catch(r){console.error("outer",r.message)}}function s(e){length=C.length;var o="";if(0==e)return C[0];for(;e>0;)val=parseInt(e%length),e=parseInt(e/length),o+=C[val];return o}e(document).keydown(function(o){if(!e("#query").is(":focus")){var a=o.charCode?o.charCode:o.keyCode;39==a?(r(),d("button","next")):37==a&&(n(),d("button","prev"))}}),e("#player").affix({offset:{top:400,bottom:function(){return this.bottom=e(".footer").outerHeight(!0)}}});var u={url:"https://api.vk.com/method/audio.search",autoComplete:1,accessToken:"fff9ef502df4bb10d9bf50dcd62170a24c69e98e4d847d9798d63dacf474b674f9a512b2b3f7e8ebf1d69",count:300},p={title:"datmusic",appUrl:window.location.protocol+"//datmusic.xyz/",downloadServerUrl:window.location.protocol+"//datmusic.xyz/",proxyMode:!0,captchaProxy:!0,captchaProxyUrl:"https://dotjpg.co/timthumb/thumb.php?w=300&src=",prettyDownloadUrlMode:!0,performerOnly:!1,sort:2,oldQuery:null,defaultLang:"en",langCookie:"musicLang",sortCookie:"musicSort",performerOnlyCookie:"musicPerformerOnly",currentTrack:-1};i18n.init({lng:e.cookie(p.langCookie)?e.cookie(p.langCookie):p.defaultLang,resStore:locales,cookieName:p.langCookie},function(o,r){e("body").i18n(),p.title=i18n.t("title")}),e('[data-toggle="tooltip"]').tooltip();var y=e("#audioTemplate").html();if(Mustache.parse(y),void 0===e.cookie("showAndroidDownload")){e.cookie("showAndroidDownload",!1,{expires:2});var h=navigator.userAgent.toLowerCase(),g=h.indexOf("android")>-1;if(g){var m=confirm(i18n.t("apkDownload"));if(1==m){d("android","confirm");var f=window.open("https://bitly.com/M-APK","_blank");f.focus()}else d("android","deny")}}if(e("#settings").on("click",function(o){e("#settingsModal").modal("show")}),e("#languageSelect").val(i18n.lng()),e.cookie(p.sortCookie)?(e("#sortSelect").val(e.cookie(p.sortCookie)),p.sort=e.cookie(p.sortCookie)):e("#sortSelect").val(p.sort),"true"==e.cookie(p.performerOnlyCookie)&&(e("#performerOnlyCheck").prop("checked",e.cookie(p.performerOnlyCookie)),p.performerOnly=e.cookie(p.performerOnlyCookie)),e("#languageSelect").on("change",function(o){i18n.setLng(e(this).val(),function(o,r){e("body").i18n(),title=e("#jp_container_1").attr("title"),e("#jp_container_1").attr("data-original-title",title),e("#jp_container_1").attr("title","")})}),e("#sortSelect").on("change",function(r){sortType=parseInt(e(this).val()),p.sort=sortType,e.cookie(p.sortCookie,sortType),null!=p.oldQuery&&o(p.oldQuery,null,null,!0)}),e("#performerOnlyCheck").change(function(){isChecked=e(this).is(":checked"),p.performerOnly=isChecked,e.cookie(p.performerOnlyCookie,isChecked),null!=p.oldQuery&&o(p.oldQuery,null,null,!0)}),e("#query").bind("keypress",function(o){13==o.keyCode&&e(".search").trigger("click")}),e(".search").on("click",function(r){typedQuery=e("#query").val(),""!=typedQuery&&o(typedQuery,null,null,!0)}),e("#jquery_jplayer_1").jPlayer({swfPath:p.appUrl+"js",supplied:"mp3",wmode:"window",smoothPlayBar:!0,keyEnabled:!0,remainingDuration:!0,toggleDuration:!0,volume:1,keyBindings:{play:{key:32,fn:function(e){d("button","play/pause"),e.status.paused?e.play():e.pause()}}},ended:function(){itemCount=e(".list-group-item").length,console.log("#"+p.currentTrack+" ended, audio count in dom = "+itemCount),r()}}),e(".jp-play").click(function(){currentTrackEl=e(e(".list-group-item")[p.currentTrack]).find(".play"),e(el).find(".glyphicon").addClass("glyphicon-pause"),e(el).find(".glyphicon").removeClass("glyphicon-play")}),e(".jp-pause").click(function(){currentTrackEl=e(e(".list-group-item")[p.currentTrack]).find(".play"),e(el).find(".glyphicon").addClass("glyphicon-play"),e(el).find(".glyphicon").removeClass("glyphicon-pause")}),window.onpopstate=function(e){l(),console.log(e)},location.hash.length>2){var k=decodeURIComponent(escape(window.atob(location.hash.substring(1,location.hash.length))));o(k,null,null,!0),e("#query").val(k)}else if(!l()){var w=["Agnes Obel","Aloe Black","Andrew Belle","Angus Stone","Arctic Monkeys","Avicii","Balmorhea","Barcelona","Bastille","Bastille","Ben Howard","Benj Heard","Birdy","Broods","Calvin Harris","Charlotte OC","City of The Sun","Clint Mansell","Coldplay","Daft Punk","Damien Rice","Daniela Andrade","Daughter","David O'Dowda","Dawn Golden","Dirk Maassen","Ed Sheeran","Fabrizio Paterlini","Fink","Fleurie","Gem club","Greg Haines","Greg Maroney","Groen Land","Hans Zimmer","Hozier","Jamie XX","Jaymes Young","Jessie J","Josef Salvat","Julia Kent","Kai Engel","Keaton Henson","Kina Grannis","Kodaline","Kygo","Kyle Landry","Lana Del Rey","Lera Lynn","Lights & Motion","Linus Young","Lo-Fang","Lo-Fang","Lorde","Ludovico Einaudi","M83","MONO","MS MR","Macklemore","Mammals","Maroon 5","Martin Garrix","Mattia Cupelli","Max Richter","Message To Bears","Mogwai","Mumford & Sons","Nils Frahm","ODESZA","Of Monsters and Men","Oh Wonder","Philip Glass","Phoebe Ryan","Ryan Keen","Sam Smith","Seinabo Sey","Sia","Takahiro Kido","The xx","Tom Odell","VLNY","Wye Oak","X ambassadors","Yann Tiersen","Yiruma","Young Summer","Zack Hemsey","Zinovia","deadmau5","pg.lost","Ólafur Arnalds","Нервы"],v=w[Math.floor(Math.random()*w.length)];o(v,null,null,!1,!0),e("#query").val(v)}Number.prototype.toTime=function(){var e=parseInt(this,10),o=Math.floor(e/3600),r=Math.floor((e-3600*o)/60),n=e-3600*o-60*r;10>r&&(r="0"+r),10>n&&(n="0"+n);var a=r+":"+n;return a};var C=["A","B","C","D","E","F","G","H","J","K","M","N","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","j","k","m","n","p","q","r","s","t","u","v","x","y","z","1","2","3"]});