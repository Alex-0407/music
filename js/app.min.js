$(document).ready(function(e){function o(o,a,l,d,u){o.length>1&&o!=s.oldQuery&&(window.history.pushState(o,e("title").html(),"?q="+o),document.title=o.split(" -")[0]+" - "+s.title),s.oldQuery=o;var p={q:o,sort:s.sort,auto_complete:c.autoComplete,access_token:c.accessToken,count:c.count};null!=a&&null!=l&&(p.captcha_sid=a,p.captcha_key=l),p.performer_only=u?1:1==s.performerOnly?1:0,e.ajax({url:s.proxyMode?s.appUrl+"search.php":c.url,data:p,method:"GET",dataType:"jsonp",cache:!0,beforeSend:function(){e("#loading").show()},error:function(){n(i18n.t("networError"))},success:function(o){if(o.error)return n(5==o.error.error_code?i18n.t("tokenError"):i18n.t("error",{error:o.error.error_msg})),void(14==o.error.error_code&&t(o.error.captcha_sid,o.error.captcha_img));if(0==o.response)return void n(i18n.t("notFound"));e("#result > .list-group").html("");for(var a=1;a<o.response.length;a++)downloadUrl=s.downloadServerUrl,streamUrl=s.downloadServerUrl,ownerId=o.response[a].owner_id,aid=o.response[a].aid,s.prettyDownloadUrlMode?(streamUrl+="stream/",ownerId<0&&(ownerId*=-1,downloadUrl+="-",streamUrl+="-"),prettyId=i(ownerId)+":"+i(aid),downloadUrl+=prettyId,streamUrl+=prettyId):(downloadUrl+="download.php?audio_id="+ownerId+"_"+aid,streamUrl+="download.php?stream=true&audio_id="+ownerId+"_"+aid),audioTitle=o.response[a].artist+" - "+o.response[a].title,audioDuration=o.response[a].duration.toTime(),e("#result > .list-group").append('<li class="list-group-item"><span class="badge">'+audioDuration+'</span><span class="badge play" data-i18n="[title]clickToPlay"><span class="glyphicon glyphicon-play"></span></span><a class="iframe-download" data-i18n="[title]clickToDownload" target="_blank" data-src="'+(s.proxyMode?streamUrl:o.response[a].url)+'" href="'+downloadUrl+'">'+audioTitle+"</a></li>");if(e(".list-group").i18n(),e(".iframe-download").on("click",function(o){o.preventDefault(),url=e(this).attr("href"),e("<iframe/>").attr({src:url,style:"visibility:hidden;display:none"}).appendTo(e("body"))}),d)try{ga("send","event","search",_query)}catch(l){}e(".play").on("click",function(e){r(this)}),e("#loading").hide()}})}function r(o){e("#jquery_jplayer_1").jPlayer("setMedia",{mp3:e(o).parent().find("a").attr("data-src")}),e("#jquery_jplayer_1").jPlayer("play"),e("#jp_container_1").show(),s.currentTrack=e(".list-group-item").index(e(o).parent()),e(".list-group").find(".glyphicon-pause").each(function(o,r){e(r).removeClass("glyphicon-pause"),e(r).addClass("glyphicon-play")}),e(o).find(".glyphicon").removeClass("glyphicon-play"),e(o).find(".glyphicon").addClass("glyphicon-pause")}function n(o){e("#result > .list-group").html(""),e("#result > .list-group").append('<li class="list-group-item list-group-item-danger">'+o+"</li>"),e("#loading").hide()}function a(){return paramQuery=l("q"),paramQuery.length>1?(o(paramQuery,null,null,!0),e("#query").val(paramQuery),!0):!1}function t(r,n){try{ga("send","event","captcha")}catch(a){}e("#captchaModal").modal("show"),e("#captchaImage").attr("src",n),e("#captchaImage").on("click",function(o){e(this).attr("src",n)}),e("#captchaSend").on("click",function(){e("#captchaModal").modal("hide"),o(e("#query").val(),r,e("#captchaKey").val(),!0)}),e("#captchaKey").bind("keypress",function(o){13==o.keyCode&&e("#captchaSend").trigger("click")})}function l(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=o.exec(location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function i(e){length=f.length;var o="";if(0==e)return f[0];for(;e>0;)val=parseInt(e%length),e=parseInt(e/length),o+=f[val];return o}var c={url:"https://api.vk.com/method/audio.search",autoComplete:1,accessToken:"fff9ef502df4bb10d9bf50dcd62170a24c69e98e4d847d9798d63dacf474b674f9a512b2b3f7e8ebf1d69",count:300},s={title:"datmusic",appUrl:"http://datmusic.xyz/",downloadServerUrl:"http://datmusic.xyz/",proxyMode:!0,prettyDownloadUrlMode:!0,performerOnly:!1,sort:2,oldQuery:null,defaultLang:"en",langCookie:"musicLang",sortCookie:"musicSort",performerOnlyCookie:"musicPerformerOnly",currentTrack:-1};i18n.init({lng:e.cookie(s.langCookie)?e.cookie(s.langCookie):s.defaultLang,resStore:locales,cookieName:s.langCookie},function(o,r){e("body").i18n()});var d=navigator.userAgent.toLowerCase(),u=d.indexOf("android")>-1;if(u){var p=confirm(i18n.t("apkDownload"));if(1==p){var y=window.open("http://bitly.com/M-APK","_blank");y.focus()}}if(e("#settings").on("click",function(o){e("#settingsModal").modal("show")}),e("#languageSelect").val(i18n.lng()),e.cookie(s.sortCookie)?(e("#sortSelect").val(e.cookie(s.sortCookie)),s.sort=e.cookie(s.sortCookie)):e("#sortSelect").val(s.sort),"true"==e.cookie(s.performerOnlyCookie)&&(e("#performerOnlyCheck").prop("checked",e.cookie(s.performerOnlyCookie)),s.performerOnly=e.cookie(s.performerOnlyCookie)),e("#languageSelect").on("change",function(o){i18n.setLng(e(this).val(),function(o,r){e("body").i18n()})}),e("#sortSelect").on("change",function(r){sortType=parseInt(e(this).val()),s.sort=sortType,e.cookie(s.sortCookie,sortType),null!=s.oldQuery&&o(s.oldQuery,null,null,!0)}),e("#performerOnlyCheck").change(function(){isChecked=e(this).is(":checked"),s.performerOnly=isChecked,e.cookie(s.performerOnlyCookie,isChecked),null!=s.oldQuery&&o(s.oldQuery,null,null,!0)}),e("#query").bind("keypress",function(o){13==o.keyCode&&e(".search").trigger("click")}),e(".search").on("click",function(r){typedQuery=e("#query").val(),""!=typedQuery&&o(typedQuery,null,null,!0)}),e("#jquery_jplayer_1").jPlayer({swfPath:s.appUrl+"js",supplied:"mp3",wmode:"window",smoothPlayBar:!0,keyEnabled:!0,remainingDuration:!0,toggleDuration:!0,volume:1,ended:function(){itemCount=e(".list-group-item").length,console.log("#"+s.currentTrack+" ended, audio count in dom = "+itemCount),s.currentTrack>=0&&itemCount>=s.currentTrack?r(e(e(".list-group-item")[s.currentTrack+1]).find(".play")):console.log("seems like there no audios to play, i think")}}),e('[data-toggle="tooltip"]').tooltip(),window.onpopstate=function(e){a(),console.log(e)},!a()){var h=["Kygo","Ed Sheeran","Toe","Coldplay","The xx","MS MR","Macklemore","Lorde","Birdy","Seinabo Sey","Sia","M83","Hans Zimmer","Keaton Henson","Yiruma","Martin Garrix","Calvin Harris","Zinovia","Avicii","Of Monsters and Men","Josef Salvat","Sam Smith","deadmau5","Yann Tiersen","Jessie J"," Maroon 5","X ambassadors","Fink","Young Summer","Lana Del Rey","Arctic Monkeys","Ludovico Einaudi","Lera Lynn","Bastille","Nils Frahm","Ben Howard","Andrew Belle","Mumford & Sons","Ryan Keen","Zes","Greg Haines","Max Richter"],m=h[Math.floor(Math.random()*h.length)];o(m,null,null,!1,!0),e("#query").val(m)}var f=["A","B","C","D","E","F","G","H","J","K","M","N","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","j","k","m","n","p","q","r","s","t","u","v","x","y","z","1","2","3"];Number.prototype.toTime=function(){var e=parseInt(this,10),o=Math.floor(e/3600),r=Math.floor((e-3600*o)/60),n=e-3600*o-60*r;10>r&&(r="0"+r),10>n&&(n="0"+n);var a=r+":"+n;return a}});