$(document).ready(function(e){function o(o,r,a,t,l){g.currentTrack=-1,o.length>1&&o!=g.oldQuery&&(window.history.pushState(o,e("title").html(),"?q="+o),document.title=o.split(" -")[0]+" - "+g.title),g.oldQuery=o;var s={q:o,sort:g.sort,auto_complete:h.autoComplete,access_token:h.accessToken,count:h.count};null!=r&&null!=a&&(s.captcha_sid=r,s.captcha_key=a),s.performer_only=l?1:1==g.performerOnly?1:0,url=g.proxyMode?g.appUrl+"search.php":h.url,e.ajax({url:url,data:s,method:"GET",dataType:"jsonp",cache:!0,beforeSend:function(){e("#loading").show()},error:function(){i(i18n.t("networkError"))},success:function(r){if(r.error)return i(5==r.error.error_code?i18n.t("tokenError"):i18n.t("error",{error:r.error.error_msg})),void(14==r.error.error_code&&d(r.error.captcha_sid,r.error.captcha_img));if(0==r.response)return void i(i18n.t("notFound"));e("#result > .list-group").html("");for(var a=1;a<r.response.length;a++)downloadUrl=g.downloadServerUrl,streamUrl=g.downloadServerUrl,ownerId=r.response[a].owner_id,aid=r.response[a].aid,g.prettyDownloadUrlMode?(streamUrl+="stream/",ownerId<0&&(ownerId*=-1,downloadUrl+="-",streamUrl+="-"),prettyId=y(ownerId)+":"+y(aid),downloadUrl+=prettyId,streamUrl+=prettyId):(downloadUrl+="download.php?audio_id="+ownerId+"_"+aid,streamUrl+="download.php?stream=true&audio_id="+ownerId+"_"+aid),audioTitle=r.response[a].artist+" - "+r.response[a].title,audioDuration=r.response[a].duration.toTime(),audioView={clickToPlay:i18n.t("clickToPlay"),clickToDownload:i18n.t("clickToDownload"),durationSeconds:r.response[a].duration,duration:r.response[a].duration.toTime(),url:{stream:g.proxyMode?streamUrl:r.response[a].url,download:{original:g.proxyMode||g.proxyDownload?downloadUrl:r.response[a].url,64:downloadUrl+(g.prettyDownloadUrlMode?"/64":"&bitrate=64"),128:downloadUrl+(g.prettyDownloadUrlMode?"/128":"&bitrate=128"),192:downloadUrl+(g.prettyDownloadUrlMode?"/192":"&bitrate=192"),320:downloadUrl+(g.prettyDownloadUrlMode?"/320":"&bitrate=320")}},audio:r.response[a].artist+" - "+r.response[a].title},audioRendered=Mustache.render(m,audioView),e("#result > .list-group").append(audioRendered);u("search",o),e("#loading").hide(),n()}})}function n(){e(".play").on("click",function(o){t(e(".list-group-item").index(e(this).parent()))}),e(".badge-download").on("shown.bs.dropdown",function(){dropdown=e(this),infoEl=e(dropdown.find(".info-link")[0]),link=infoEl.attr("data-stream"),duration=parseInt(e(infoEl).attr("data-duration")),g.proxyMode||g.proxyDownload?"..."==infoEl.text()&&c(link,function(e){bitrate=parseInt(e/duration/120),info=p(e,!0)+", ~"+bitrate+" kbps",infoEl.text(info)}):infoEl.text(i18n.t("clickToDownload"))}),e(".badge-download a").on("click",function(){"#"!=e(this).attr("href")&&(e(this).hasClass("info-link")?u("download","bitrate = default"):(bitrate=e(this).text().replace(/[^\d.]/g,""),0==bitrate.length?u("download","bitrate = default"):u("download","bitrate = "+bitrate)))})}function r(){0>g.currentTrack||(itemCount=e(".list-group-item").length-1,g.currentTrack+1<=itemCount?t(g.currentTrack+1):(console.log("seems like there no audios to play, i think. playing first one."),t(0)),u("play","next"))}function a(){0>g.currentTrack||(g.currentTrack-1>=0?t(g.currentTrack-1):(console.log("this is first audio, nothing in back. playing last one."),itemCount=e(".list-group-item").length-1,t(itemCount)),u("play","prev"))}function t(o){return el=e(e(".list-group-item")[o]).find(".play"),o==g.currentTrack?void(e("#jquery_jplayer_1").data().jPlayer.status.paused?(e("#jquery_jplayer_1").jPlayer("play"),e(el).find(".glyphicon").removeClass("glyphicon-play"),e(el).find(".glyphicon").addClass("glyphicon-pause")):(e("#jquery_jplayer_1").jPlayer("pause"),e(el).find(".glyphicon").removeClass("glyphicon-pause"),e(el).find(".glyphicon").addClass("glyphicon-play"))):el.length?(e("#jquery_jplayer_1").jPlayer("setMedia",{mp3:e(el).parent().find("a.name").attr("data-src")}),e(".jp-audio .jp-current-name").text(e(el).parent().find("a.name").text()),e("#jquery_jplayer_1").jPlayer("play"),e("#jp_container_1").show(),e("#player-space").show(),g.currentTrack=o,e(".list-group").find(".glyphicon-pause").each(function(o,n){e(n).removeClass("glyphicon-pause"),e(n).addClass("glyphicon-play")}),e(el).find(".glyphicon").removeClass("glyphicon-play"),e(el).find(".glyphicon").addClass("glyphicon-pause"),void u("playAudio",e(e(".list-group-item")[o]).find("a.name").html())):void console.log("#"+o+" audio not found in dom")}function i(o){e("#result > .list-group").html(""),e("#result > .list-group").append('<li class="list-group-item list-group-item-danger">'+o+"</li>"),e("#loading").hide()}function l(){return paramQuery=s("q"),paramQuery.length>1?(o(paramQuery,null,null,!0),e("#query").val(paramQuery),!0):!1}function d(n,r){g.captchaProxy&&(r=g.captchaProxyUrl+r),e("#captchaModal").modal("show"),e("#captchaImage").attr("src",r),e("#captchaImage").on("click",function(o){e(this).attr("src",r)}),e("#captchaSend").on("click",function(){e("#captchaModal").modal("hide"),o(e("#query").val(),n,e("#captchaKey").val(),!0)}),e("#captchaKey").bind("keypress",function(o){13==o.keyCode&&e("#captchaSend").trigger("click")}),u("captcha")}function s(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=o.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function c(e,o){var n=new XMLHttpRequest;n.open("HEAD",e,!0),n.onreadystatechange=function(){this.readyState==this.DONE&&o(parseInt(n.getResponseHeader("Content-Length")))},n.send()}function u(e,o){try{ga&&ga("send","event",e,o)}catch(n){console.error("outer",n.message)}}function p(e,o){var n=o?1e3:1024;if(Math.abs(e)<n)return e+" B";var r=o?["kB","MB","GB"]:["KiB","MiB","GiB"],a=-1;do e/=n,++a;while(Math.abs(e)>=n&&a<r.length-1);return e.toFixed(1)+" "+r[a]}function y(e){length=T.length;var o="";if(0==e)return T[0];for(;e>0;)val=parseInt(e%length),e=parseInt(e/length),o+=T[val];return o}e(document).keydown(function(o){if(!e("#query").is(":focus")){var n=o.charCode?o.charCode:o.keyCode;39==n?(r(),u("button","next")):37==n&&(a(),u("button","prev"))}}),e("#player").affix({offset:{top:400,bottom:function(){return this.bottom=e(".footer").outerHeight(!0)}}});var h={url:"https://api.vk.com/method/audio.search",autoComplete:1,accessToken:"fff9ef502df4bb10d9bf50dcd62170a24c69e98e4d847d9798d63dacf474b674f9a512b2b3f7e8ebf1d69",count:300},g={title:"datmusic",appUrl:window.location.protocol+"//datmusic.xyz/",downloadServerUrl:window.location.protocol+"//datmusic.xyz/",proxyMode:!0,proxyDownload:!0,captchaProxy:!0,captchaProxyUrl:"https://dotjpg.co/timthumb/thumb.php?w=200&src=",prettyDownloadUrlMode:!0,performerOnly:!1,sort:2,oldQuery:null,defaultLang:"en",langCookie:"musicLang",sortCookie:"musicSort",performerOnlyCookie:"musicPerformerOnly",currentTrack:-1};i18n.init({lng:e.cookie(g.langCookie)?e.cookie(g.langCookie):g.defaultLang,resStore:locales,cookieName:g.langCookie},function(o,n){e("body").i18n(),g.title=i18n.t("title")}),e('[data-toggle="tooltip"]').tooltip();var m=e("#audioTemplate").html();if(Mustache.parse(m),void 0===e.cookie("showAndroidDownload")){e.cookie("showAndroidDownload",!1,{expires:2});var f=navigator.userAgent.toLowerCase(),k=f.indexOf("android")>-1;if(k){var w=confirm(i18n.t("apkDownload"));if(1==w){u("android","confirm");var v=window.open("https://play.google.com/store/apps/details?id=tm.alashow.datmusic","_blank");v.focus()}else u("android","deny")}}if(e("#settings").on("click",function(o){e("#settingsModal").modal("show")}),e("#languageSelect").val(i18n.lng()),e.cookie(g.sortCookie)?(e("#sortSelect").val(e.cookie(g.sortCookie)),g.sort=e.cookie(g.sortCookie)):e("#sortSelect").val(g.sort),"true"==e.cookie(g.performerOnlyCookie)&&(e("#performerOnlyCheck").prop("checked",e.cookie(g.performerOnlyCookie)),g.performerOnly=e.cookie(g.performerOnlyCookie)),e("#languageSelect").on("change",function(o){i18n.setLng(e(this).val(),function(o,n){e("body").i18n(),title=e("#jp_container_1").attr("title"),e("#jp_container_1").attr("data-original-title",title),e("#jp_container_1").attr("title","")})}),e("#sortSelect").on("change",function(n){sortType=parseInt(e(this).val()),g.sort=sortType,e.cookie(g.sortCookie,sortType),null!=g.oldQuery&&o(g.oldQuery,null,null,!0)}),e("#performerOnlyCheck").change(function(){isChecked=e(this).is(":checked"),g.performerOnly=isChecked,e.cookie(g.performerOnlyCookie,isChecked),null!=g.oldQuery&&o(g.oldQuery,null,null,!0)}),e("#query").bind("keypress",function(o){13==o.keyCode&&e(".search").trigger("click")}),e(".search").on("click",function(n){typedQuery=e("#query").val(),""!=typedQuery&&o(typedQuery,null,null,!0)}),e("#jquery_jplayer_1").jPlayer({swfPath:g.appUrl+"js",supplied:"mp3",wmode:"window",smoothPlayBar:!0,keyEnabled:!0,remainingDuration:!0,toggleDuration:!0,volume:1,keyBindings:{play:{key:32,fn:function(e){u("button","play/pause"),e.status.paused?e.play():e.pause()}}},ended:function(){itemCount=e(".list-group-item").length,console.log("#"+g.currentTrack+" ended, audios count in dom = "+itemCount),r()},play:function(){currentTrackEl=e(e(".list-group-item")[g.currentTrack]).find(".play"),e(el).find(".glyphicon").addClass("glyphicon-pause"),e(el).find(".glyphicon").removeClass("glyphicon-play")},pause:function(){currentTrackEl=e(e(".list-group-item")[g.currentTrack]).find(".play"),e(el).find(".glyphicon").addClass("glyphicon-play"),e(el).find(".glyphicon").removeClass("glyphicon-pause")}}),window.onpopstate=function(e){l(),console.log(e)},location.hash.length>2){var C=decodeURIComponent(escape(window.atob(location.hash.substring(1,location.hash.length))));o(C,null,null,!0),e("#query").val(C)}else if(!l()){var b=["2 Cellos","Agnes Obel","Aloe Black","Andrew Belle","Angus Stone","Aquilo","Arctic Monkeys","Avicii","Balmorhea","Barcelona","Bastille","Ben Howard","Benj Heard","Birdy","Broods","Calvin Harris","Charlotte OC","City of The Sun","Civil Twilight","Clint Mansell","Coldplay","Daft Punk","Damien Rice","Daniela Andrade","Daughter","David O'Dowda","Dawn Golden","Dirk Maassen","Ed Sheeran","Eminem","Fabrizio Paterlini","Fink","Fleurie","Florence and The Machine","Gem club","Glass Animals","Greg Haines","Greg Maroney","Groen Land","Halsey","Hans Zimmer","Hozier","Imagine Dragons","Ingrid Michaelson","Jamie XX","Jarryd James","Jasmin Thompson","Jaymes Young","Jessie J","Josef Salvat","Julia Kent","Kai Engel","Keaton Henson","Kendra Logozar","Kina Grannis","Kodaline","Kygo","Kyle Landry","Lana Del Rey","Lera Lynn","Lights & Motion","Linus Young","Lo-Fang","Lorde","Ludovico Einaudi","M83","MONO","MS MR","Macklemore","Mammals","Maroon 5","Martin Garrix","Mattia Cupelli","Max Richter","Message To Bears","Mogwai","Mumford & Sons","Nils Frahm","ODESZA","Oasis","Of Monsters and Men","Oh Wonder","Philip Glass","Phoebe Ryan","Rachel Grimes","Radiohead","Ryan Keen","Sam Smith","Seinabo Sey","Sia","Takahiro Kido","The Irrepressibles","The Neighbourhood","The xx","Tom Odell","VLNY","Wye Oak","X ambassadors","Yann Tiersen","Yiruma","Young Summer","Zack Hemsey","Zinovia","deadmau5","pg.lost","Ólafur Arnalds","Нервы"],M=b[Math.floor(Math.random()*b.length)];o(M,null,null,!1,!0),e("#query").val(M)}e.getScript("js/app.extra.js"),Number.prototype.toTime=function(){var e=parseInt(this,10);return(e-(e%=60))/60+(e>9?":":":0")+e};var T=["A","B","C","D","E","F","G","H","J","K","M","N","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","j","k","m","n","p","q","r","s","t","u","v","x","y","z","1","2","3"]});