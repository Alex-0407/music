$(document).ready(function(e){function o(o,a,t,s,d){o.length>1&&o!=c.oldQuery&&(window.history.pushState(o,e("title").html(),"?q="+o),document.title=o.split(" -")[0]+" - datmusic"),c.oldQuery=o;var u={q:o,sort:c.sort,auto_complete:i.autoComplete,access_token:i.accessToken,count:i.count};null!=a&&null!=t&&(u.captcha_sid=a,u.captcha_key=t),u.performer_only=d?1:1==c.performerOnly?1:0,e.ajax({url:c.proxyMode?c.appUrl+"search.php":i.url,data:u,method:"GET",dataType:"jsonp",cache:!0,beforeSend:function(){e("#loading").show()},error:function(){r(i18n.t("networError"))},success:function(o){if(o.error)return r(5==o.error.error_code?i18n.t("tokenError"):i18n.t("error",{error:o.error.error_msg})),void(14==o.error.error_code&&n(o.error.captcha_sid,o.error.captcha_img));if(0==o.response)return void r(i18n.t("notFound"));e("#result > .list-group").html("");for(var a=1;a<o.response.length;a++)downloadUrl=c.downloadServerUrl,ownerId=o.response[a].owner_id,aid=o.response[a].aid,c.prettyDownloadUrlMode?(ownerId<0&&(ownerId*=-1,downloadUrl+="-"),downloadUrl+=l(ownerId)+":"+l(aid)):downloadUrl+="download.php?audio_id="+ownerId+"_"+aid,audioTitle=o.response[a].artist+" - "+o.response[a].title,audioDuration=o.response[a].duration.toTime(),e("#result > .list-group").append('<li class="list-group-item"><span class="badge">'+audioDuration+'</span><span class="badge play" data-i18n="[title]clickToPlay"><span class="glyphicon glyphicon-play"></span></span><a class="iframe-download" data-i18n="[title]clickToDownload" target="_blank" data-src="'+(c.proxyMode?downloadUrl:o.response[a].url)+'" href="'+downloadUrl+'">'+audioTitle+"</a></li>");if(e(".list-group").i18n(),e(".iframe-download").on("click",function(o){o.preventDefault(),url=e(this).attr("href"),e("<iframe/>").attr({src:url,style:"visibility:hidden;display:none"}).appendTo(e("body"))}),s)try{ga("send","event","search",_query)}catch(t){}e(".play").on("click",function(o){e("#jquery_jplayer_1").jPlayer("setMedia",{mp3:e(this).parent().find("a").attr("data-src")}),e("#jquery_jplayer_1").jPlayer("play"),e("#jp_container_1").show(),window.scrollTo(0,0)}),e("#loading").hide()}})}function r(o){e("#result > .list-group").html(""),e("#result > .list-group").append('<li class="list-group-item list-group-item-danger">'+o+"</li>"),e("#loading").hide()}function a(){return paramQuery=t("q"),paramQuery.length>1?(o(paramQuery,null,null,!0),e("#query").val(paramQuery),!0):!1}function n(r,a){try{ga("send","event","captcha")}catch(n){}e("#captchaModal").modal("show"),e("#captchaImage").attr("src",a),e("#captchaImage").on("click",function(o){e(this).attr("src",a)}),e("#captchaSend").on("click",function(){e("#captchaModal").modal("hide"),o(e("#query").val(),r,e("#captchaKey").val(),!0)}),e("#captchaKey").bind("keypress",function(o){13==o.keyCode&&e("#captchaSend").trigger("click")})}function t(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+e+"=([^&#]*)"),r=o.exec(location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}function l(e){length=f.length;var o="";if(0==e)return f[0];for(;e>0;)val=parseInt(e%length),e=parseInt(e/length),o+=f[val];return o}var i={url:"https://api.vk.com/method/audio.search",autoComplete:1,accessToken:"fff9ef502df4bb10d9bf50dcd62170a24c69e98e4d847d9798d63dacf474b674f9a512b2b3f7e8ebf1d69",count:300},c={appUrl:"http://datmusic.xyz/",downloadServerUrl:"http://datmusic.xyz/",proxyMode:!0,prettyDownloadUrlMode:!0,performerOnly:!1,sort:2,oldQuery:null,defaultLang:"en",langCookie:"musicLang",sortCookie:"musicSort",performerOnlyCookie:"musicPerformerOnly"};i18n.init({lng:e.cookie(c.langCookie)?e.cookie(c.langCookie):c.defaultLang,resStore:locales,cookieName:c.langCookie},function(o,r){e("body").i18n()});var s=navigator.userAgent.toLowerCase(),d=s.indexOf("android")>-1;if(d){var u=confirm(i18n.t("apkDownload"));if(1==u){var p=window.open("http://bitly.com/M-APK","_blank");p.focus()}}if(e("#settings").on("click",function(o){e("#settingsModal").modal("show")}),e("#languageSelect").val(i18n.lng()),e.cookie(c.sortCookie)?(e("#sortSelect").val(e.cookie(c.sortCookie)),c.sort=e.cookie(c.sortCookie)):e("#sortSelect").val(c.sort),"true"==e.cookie(c.performerOnlyCookie)&&(e("#performerOnlyCheck").prop("checked",e.cookie(c.performerOnlyCookie)),c.performerOnly=e.cookie(c.performerOnlyCookie)),e("#languageSelect").on("change",function(o){i18n.setLng(e(this).val(),function(o,r){e("body").i18n()})}),e("#sortSelect").on("change",function(r){sortType=parseInt(e(this).val()),c.sort=sortType,e.cookie(c.sortCookie,sortType),null!=c.oldQuery&&o(c.oldQuery,null,null,!0)}),e("#performerOnlyCheck").change(function(){isChecked=e(this).is(":checked"),c.performerOnly=isChecked,e.cookie(c.performerOnlyCookie,isChecked),null!=c.oldQuery&&o(c.oldQuery,null,null,!0)}),e("#query").bind("keypress",function(o){13==o.keyCode&&e(".search").trigger("click")}),e(".search").on("click",function(r){typedQuery=e("#query").val(),""!=typedQuery&&o(typedQuery,null,null,!0)}),e("#jquery_jplayer_1").jPlayer({swfPath:c.appUrl+"js",supplied:"mp3",wmode:"window",smoothPlayBar:!0,keyEnabled:!0,remainingDuration:!0,toggleDuration:!0,volume:1}),e('[data-toggle="tooltip"]').tooltip(),window.onpopstate=function(e){a(),console.log(e)},!a()){var y=["Kygo","Ed Sheeran","Toe","Coldplay","The xx","MS MR","Macklemore","Lorde","Birdy","Seinabo Sey","Sia","M83","Hans Zimmer","Keaton Henson","Yiruma","Martin Garrix","Calvin Harris","Zinovia","Avicii","Of Monsters and Men","Josef Salvat","Sam Smith","deadmau5","Yann Tiersen","Jessie J"," Maroon 5","X ambassadors","Fink","Young Summer","Lana Del Rey","Arctic Monkeys","Ludovico Einaudi","Lera Lynn","Bastille","Nils Frahm","Ben Howard","Andrew Belle","Mumford & Sons","Ryan Keen","Zes","Greg Haines","Max Richter"],h=y[Math.floor(Math.random()*y.length)];o(h,null,null,!1,!0),e("#query").val(h)}var f=["A","B","C","D","E","F","G","H","J","K","M","N","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","j","k","m","n","p","q","r","s","t","u","v","x","y","z","1","2","3"];Number.prototype.toTime=function(){var e=parseInt(this,10),o=Math.floor(e/3600),r=Math.floor((e-3600*o)/60),a=e-3600*o-60*r;10>r&&(r="0"+r),10>a&&(a="0"+a);var n=r+":"+a;return n}});